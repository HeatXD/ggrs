<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" as="font" href="https://gschup.github.io/ggrs/fonts/vendor/jost/jost-v4-latin-regular.woff2" type="font/woff2" crossorigin>
  <link rel="preload" as="font" href="https://gschup.github.io/ggrs/fonts/vendor/jost/jost-v4-latin-700.woff2"  type="font/woff2" crossorigin>


<link rel="stylesheet" href="https://gschup.github.io/ggrs/main.css">



  
  
    
  

  
  
    
    
  
  
  
    
  
  
  
  
    
  
  
  


  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">


	


	

<title>Sessions | GGRS</title>
<meta name="description" content="GGRS is a reimagination of the GGPO network SDK written in 100% safe Rust.">
<link rel="canonical" href="https://gschup.github.io/ggrs/docs/tutorial/sessions/">


  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="doks.png">
  <meta name="twitter:title" content="Sessions">
  <meta name="twitter:description" content="GGRS is a reimagination of the GGPO network SDK written in 100% safe Rust.">
  <meta name="twitter:site" content="@g_schup">
  <meta name="twitter:creator" content="@g_schup">
  
  <meta property="og:title" content="Sessions">
  <meta property="og:description" content="GGRS is a reimagination of the GGPO network SDK written in 100% safe Rust.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://gschup.github.io/ggrs/docs/tutorial/sessions/">

  
    <meta property="og:image" content="doks.png">
  

  <meta property="og:updated_time" content="2021-09-13T00:00:00+00:00">
  <meta property="og:site_name" content="Sessions">

  

  

  
  <meta property="article:publisher" content="https://www.facebook.com/">
  <meta property="article:author" content="https://www.facebook.com/">
  <meta property="og:locale" content="en_US">





  





<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    
      
      
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://gschup.github.io/ggrs/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "Docs",
            "item": "https://gschup.github.io/ggrs/docs/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  3 ,
            "name": "Tutorial",
            "item": "https://gschup.github.io/ggrs/docs/tutorial/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  4 ,
            "name": "Sessions",
            "item": "https://gschup.github.io/ggrs/docs/tutorial/sessions/"
          },
        
      
    
  }
</script>




  <meta name="theme-color" content="#fff">
  <link rel="apple-touch-icon" sizes="180x180" href="https://gschup.github.io/ggrs/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://gschup.github.io/ggrs/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://gschup.github.io/ggrs/favicon-16x16.png">
  
    <link rel="manifest" href="https://gschup.github.io/ggrs/site.webmanifest">
  


  

</head>

  

<body class="docs single">
  
  
  
  
<div class="header-bar fixed-top"></div>
<header class="navbar fixed-top navbar-expand-md navbar-light">
	<div class="container">
		<input class="menu-btn order-0" type="checkbox" id="menu-btn">
		<label class="menu-icon d-md-none" for="menu-btn"><span class="navicon"></span></label>
		<a class="navbar-brand order-1 order-md-0 me-auto" href="https://gschup.github.io/ggrs/">GGRS</a>
		<button id="mode" class="btn btn-link order-2 order-md-4" type="button" aria-label="Toggle mode">
			<span class="toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></span>
			<span class="toggle-light"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></span>
		</button>
		<ul class="navbar-nav fork-me order-3 order-md-5">
			
				
					<li class="nav-item">
						<a class="nav-link" href="https://twitter.com/g_schup"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg><span class="ms-2 visually-hidden">Twitter</span></a>
					</li>
				
					<li class="nav-item">
						<a class="nav-link" href="https://github.com/gschup/ggrs"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ms-2 visually-hidden">GitHub</span></a>
					</li>
				
			
		</ul>
		<div class="collapse navbar-collapse order-4 order-md-1">
			<ul class="navbar-nav main-nav me-auto order-5 order-md-2">
				
					
						<li class="nav-item docs active">
							<a class="nav-link" href="https://gschup.github.io/ggrs/docs/getting-started/introduction/">Docs</a>
						</li>
					
						<li class="nav-item">
							<a class="nav-link" href="https://gschup.github.io/ggrs/blog/">Blog</a>
						</li>
					
				
			</ul>
			<div class="break order-6 d-md-none"></div>
			
				<form class="navbar-form flex-grow-1 order-7 order-md-3">
					<input id="userinput" class="form-control is-search" type="search" placeholder="Search docs..."
						aria-label="Search docs..." autocomplete="off">
					<div id="suggestions" class="shadow bg-white rounded"></div>
				</form>
			
		</div>
	</div>
</header>



  
<div class="wrap container" role="document">
  <div class="content">
    <div class="row flex-xl-nowrap">
	  
<div class="col-lg-5 col-xl-4 docs-sidebar">
	<nav class="docs-links" aria-label="Main navigation">
			
			
			
			
					
					
					
							<h3>Getting Started</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://gschup.github.io/ggrs/docs/getting-started/introduction/">Introduction</a></li>
							
					</ul>
					
					
					
					
							<h3>Tutorial</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://gschup.github.io/ggrs/docs/tutorial/setup/">Setup</a></li>
							                           
									<li><a class="docs-link active" href="https://gschup.github.io/ggrs/docs/tutorial/sessions/">Sessions</a></li>
							                           
									<li><a class="docs-link" href="https://gschup.github.io/ggrs/docs/tutorial/main-loop/">Main Loop</a></li>
							                           
									<li><a class="docs-link" href="https://gschup.github.io/ggrs/docs/tutorial/requests-events/">Requests and Events</a></li>
							                           
									<li><a class="docs-link" href="https://gschup.github.io/ggrs/docs/tutorial/time-sync/">Time Synchronization</a></li>
							
					</ul>
					
					
					
					
							<h3>Contributing</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://gschup.github.io/ggrs/docs/contributing/how-to-contribute/">How to Contribute</a></li>
							                           
									<li><a class="docs-link" href="https://gschup.github.io/ggrs/docs/contributing/code-of-conduct/">Code of Conduct</a></li>
							
					</ul>
					
					
					
					
							<h3>Help</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://gschup.github.io/ggrs/docs/help/faq/">FAQ</a></li>
							
					</ul>
					
					
			
	</nav>
</div>

	  
  
  <nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation">
  	<div class="page-links">
  			<h3>On this page</h3>
  			<nav id="TableOfContents">
  					<ul>
  							
  							<li><a href="https://gschup.github.io/ggrs/docs/tutorial/sessions/#setup">Setup</a></li>
  							
  							
  							<li><a href="https://gschup.github.io/ggrs/docs/tutorial/sessions/#p2psession">P2PSession</a></li>
  							
  							
  							<li><a href="https://gschup.github.io/ggrs/docs/tutorial/sessions/#p2pspectatorsession">P2PSpectatorSession</a></li>
  							
  							
  							<li><a href="https://gschup.github.io/ggrs/docs/tutorial/sessions/#synctestsession">SyncTestSession</a></li>
  							
  							
  					</ul>
  			</nav>
  	</div>
  </nav>
  

      <main class="docs-content col-lg-11 col-xl-9">
        <h1>Sessions</h1>
        
        <p>GGRS mainly operates through one of three sessions; each providing different functionalities:</p>
<ul>
<li><code>P2PSession</code>: Communicate with other remote sessions; send and receive inputs to synchronize your game between clients. All Clients participating in the game create their own session and connect to each other in a peer-to-peer fashion.</li>
<li><code>P2PSpectatorSession</code>: Connects to another <code>P2PSession</code> in order to receive confirmed game inputs without contributing to the game input itself. If you want clients to spectate games, this is the session to use.</li>
<li><code>SyncTestSession</code>: Used mainly for debugging purposes, this session simulates a configurable amount of rollbacks each frame. This is a great way to test if your game updates deterministically. The <code>SyncTestSession</code> will compare checksums between original and resimulated gamestates and raise an error if something went wrong.</li>
</ul>
<h2 id="setup">Setup</h2>
<p>For all sessions, you will have to define the number of active players contributing to the game input via <code>num_players</code> as well as the size of such inputs via <code>input_size</code>. The <code>local_port</code> is where your client will receive packets of remote clients.</p>
<h2 id="p2psession">P2PSession</h2>
<p>A P2PSession communicates with other P2PSessions and P2PSpectatorSessions. They send and receive inputs to synchronize your game between clients. All Clients participating in the game create their own session and connect to each other in a peer-to-peer fashion.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">let</span><span> local_port: </span><span style="color:#b48ead;">u16 </span><span>= </span><span style="color:#d08770;">7000</span><span>;</span><span>
</span><span style="color:#b48ead;">let</span><span> num_players : </span><span style="color:#b48ead;">u32 </span><span>= </span><span style="color:#d08770;">2</span><span>;</span><span>
</span><span style="color:#b48ead;">let</span><span> input_size : </span><span style="color:#b48ead;">usize </span><span>= std::mem::size_of::&lt;</span><span style="color:#b48ead;">u32</span><span>&gt;();</span><span>
</span><span>
</span><span style="color:#b48ead;">let mut</span><span> sess = P2PSession::new(num_players, input_size, local_port)?;</span><span>
</span></code></pre>
<p>Then, you should specify the players participating in the game, exactly as many as you defined through <code>num_players</code>. You can add exactly one <code>PlayerType::Local</code>, the rest should be <code>PlayerType::Remote(addr)</code>.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">let</span><span> local_handle = </span><span style="color:#d08770;">0</span><span>;</span><span>
</span><span style="color:#b48ead;">let</span><span> remote_handle = </span><span style="color:#d08770;">1</span><span>;</span><span>
</span><span style="color:#b48ead;">let</span><span> remote_addr: SocketAddr = &quot;</span><span style="color:#a3be8c;">127.0.0.1:7001</span><span>&quot;.</span><span style="color:#96b5b4;">parse</span><span>()?;</span><span>
</span><span>
</span><span>sess.</span><span style="color:#96b5b4;">add_player</span><span>(PlayerType::Local, local_handle)?;</span><span>
</span><span>sess.</span><span style="color:#96b5b4;">add_player</span><span>(PlayerType::Remote(remote_addr), remote_handle)?;</span><span>
</span></code></pre>
<p>Optionally, define any spectators you wish to add. The <code>spectator_handle</code> should be greater or equal to <code>num_players</code>. Internally, GGRS will add 1000 to the provided handle to identify the spectator client, so the resulting internal handle will be 1002 in this example.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">let</span><span> spectator_handle = </span><span style="color:#d08770;">2</span><span>;</span><span>
</span><span style="color:#b48ead;">let</span><span> spec_addr: SocketAddr = &quot;</span><span style="color:#a3be8c;">127.0.0.1:7002</span><span>&quot;.</span><span style="color:#96b5b4;">parse</span><span>()?;</span><span>
</span><span>sess.</span><span style="color:#96b5b4;">add_player</span><span>(PlayerType::Spectator(spec_addr), spectator_handle)?;</span><span>
</span></code></pre>
<p>You can set input delay for the local player. You do not need to do this for remote players.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">let</span><span> desired_delay = </span><span style="color:#d08770;">2</span><span>;</span><span>
</span><span>sess.</span><span style="color:#96b5b4;">set_frame_delay</span><span>(desired_delay, local_handle)?;</span><span>
</span></code></pre>
<p>Per default, GGRS requests to save the gamestate after every update step in order to minimize rollbacks as much as possible. If saving your game state takes much longer than performing multiple update steps, GGRS has an alternative sparse saving mode where instead the amount of save requests are minimized at the cost of some additional state update requests.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>sess.</span><span style="color:#96b5b4;">set_sparse_saving</span><span>(</span><span style="color:#d08770;">true</span><span>)?;</span><span>
</span></code></pre>
<p>Finally, you can start the session. GGRS will then make an effort to establish communication between all clients. Only if the connection to all remotes (including spectators) has been established, the session will be able to advance the gamestate and send inputs.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>sess.</span><span style="color:#96b5b4;">start_session</span><span>()?;</span><span>
</span></code></pre>
<h2 id="p2pspectatorsession">P2PSpectatorSession</h2>
<p>The <code>P2PSpectatorSession</code> connects to another <code>P2PSession</code> in order to receive confirmed game inputs without contributing to the game input itself. If you want clients to spectate games, this is the session to use. For the spectator, you will have to define a <code>host_addr</code> from which this session will receive inputs from all players. The defined host needs to add this client as a spectator, as well.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">let</span><span> local_port: </span><span style="color:#b48ead;">u16 </span><span>= </span><span style="color:#d08770;">7002</span><span>;</span><span>
</span><span style="color:#b48ead;">let</span><span> num_players : </span><span style="color:#b48ead;">u32 </span><span>= </span><span style="color:#d08770;">2</span><span>;</span><span>
</span><span style="color:#b48ead;">let</span><span> input_size : </span><span style="color:#b48ead;">usize </span><span>= std::mem::size_of::&lt;</span><span style="color:#b48ead;">u32</span><span>&gt;();</span><span>
</span><span style="color:#b48ead;">let</span><span> host_addr: SocketAddr = &quot;</span><span style="color:#a3be8c;">127.0.0.1:7000</span><span>&quot;.</span><span style="color:#96b5b4;">parse</span><span>()?;</span><span>
</span><span>
</span><span style="color:#b48ead;">let mut</span><span> sess = P2PSpectatorSession::new(num_players, input_size, local_port, host_addr)?;</span><span>
</span></code></pre>
<p>Optionally, you can change the default catch-up parameters. Setting the catch-up speed to 1 will prevent any catch-up measures.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>sess.</span><span style="color:#96b5b4;">set_max_frames_behind</span><span>(</span><span style="color:#d08770;">5</span><span>)?; </span><span>
</span><span>sess.</span><span style="color:#96b5b4;">set_catchup_speed</span><span>(</span><span style="color:#d08770;">2</span><span>)?;</span><span>
</span></code></pre>
<p>Then, you can start the session. GGRS will then make an effort to establish communication to the host. Only then will the session be able to advance the gamestate.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span>sess.</span><span style="color:#96b5b4;">start_session</span><span>()?;</span><span>
</span></code></pre>
<h2 id="synctestsession">SyncTestSession</h2>
<p>Used mainly for debugging purposes, this session simulates a configurable amount of rollbacks each frame. This is a great way to test if your game updates deterministically. The <code>SyncTestSession</code> will compare checksums between original and resimulated gamestates and raise an error if something went wrong. <code>check_distance</code> specifies how many frames of rollback you want to induce every frame. This value cannot exceed the maximum predicition frames allowed. Currently, 7 is the maximum distance of rollback that can occur.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">let</span><span> check_distance : </span><span style="color:#b48ead;">u32 </span><span>= </span><span style="color:#d08770;">7</span><span>;</span><span>
</span><span style="color:#b48ead;">let</span><span> num_players : </span><span style="color:#b48ead;">u32 </span><span>= </span><span style="color:#d08770;">2</span><span>;</span><span>
</span><span style="color:#b48ead;">let</span><span> input_size : </span><span style="color:#b48ead;">usize </span><span>= std::mem::size_of::&lt;</span><span style="color:#b48ead;">u32</span><span>&gt;();</span><span>
</span><span>
</span><span style="color:#b48ead;">let mut</span><span> sess = SyncTestSession::new(num_players, input_size, check_distance)?;</span><span>
</span></code></pre>
<p>Afterwards, you can optionally define input delays for any player you wish.</p>
<pre data-lang="rust" style="background-color:#2b303b;color:#c0c5ce;" class="language-rust "><code class="language-rust" data-lang="rust"><span style="color:#b48ead;">let</span><span> input_delay = </span><span style="color:#d08770;">2</span><span>;</span><span>
</span><span>
</span><span>sess.</span><span style="color:#96b5b4;">set_frame_delay</span><span>(input_delay, </span><span style="color:#d08770;">0</span><span>)?;</span><span>
</span><span>sess.</span><span style="color:#96b5b4;">set_frame_delay</span><span>(input_delay, </span><span style="color:#d08770;">1</span><span>)?;</span><span>
</span></code></pre>
<p>You don't need to define players or start the session. Because there are no remote clients to synchronize with, a <code>SyncTestSession</code> will immediately be ready to advance the game.</p>

        
        
<div class="docs-navigation d-flex justify-content-between">
  
  
  
  
  
  <a href="https:&#x2F;&#x2F;gschup.github.io&#x2F;ggrs&#x2F;docs&#x2F;tutorial&#x2F;setup&#x2F;">
    <div class="card my-1">
      <div class="card-body py-2">
        &larr; Setup
      </div>
    </div>
  </a>
  

  
  
  
  
  
    <a class="ms-auto" href="https:&#x2F;&#x2F;gschup.github.io&#x2F;ggrs&#x2F;docs&#x2F;tutorial&#x2F;main-loop&#x2F;">
      <div class="card my-1">
        <div class="card-body py-2">
          Main Loop &rarr;
        </div>
      </div>
    </a>
  
</div>

      </main>
    </div>
  </div>
</div>


  
    
<footer class="footer text-muted">
	<div class="container">
		<div class="row">
			<div class="col-lg-8 order-last order-lg-first">
				<ul class="list-inline">
					
						<li class="list-inline-item">Powered by <a href="https://www.getzola.org/">Zola</a> and <a href="https://github.com/aaranxu/adidoks">AdiDoks</a></li>
					
				</ul>
			</div>
			<div class="col-lg-8 order-first order-lg-last text-lg-end">
				<ul class="list-inline">
					
						
							<li class="list-inline-item"><a href="https://gschup.github.io/ggrs/privacy-policy/">Privacy</a></li>
						
							<li class="list-inline-item"><a href="https://gschup.github.io/ggrs/docs/contributing/code-of-conduct/">Code of Conduct</a></li>
						
					
				</ul>
			</div>
		</div>
	</div>
</footer>

  

  
<script src="https://gschup.github.io/ggrs/js/main.js" defer></script>

  <script src="https://gschup.github.io/ggrs/plugins/elasticlunr.min.js" defer></script>
  <script src="https://gschup.github.io/ggrs/search_index.en.js" defer></script>
  <script src="https://gschup.github.io/ggrs/js/search.js" defer></script>

  
</body>
</html>
